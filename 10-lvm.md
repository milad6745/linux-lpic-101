LVM یا Logical Volume Manager 

یک سیستم مدیریت فضای دیسک در لینوکس است که امکان ایجاد و مدیریت حجم‌های منطقی (logical volumes) را بر روی یک یا چند دیسک فیزیک فراهم می‌کند. این ابزار به کاربر این امکان را می‌دهد تا فضای ذخیره‌سازی را به صورت انعطاف‌پذیر‌تر مدیریت کند، از جمله تغییر اندازه حجم‌ها، افزودن و حذف حجم‌ها بدون نیاز به خاموش کردن سیستم.

برخی اصطلاحات مرتبط با LVM:

1. **پیش‌فرض LVM:**
   - **Physical Volume (PV):** یک دیسک فیزیک یا یک بخش از یک دیسک که به عنوان واحد اصلی برای LVM عمل می‌کند.
   - **Volume Group (VG):** یک گروه از دیسک‌ها یا بخش‌ها که به صورت یک واحد توسط LVM مدیریت می‌شود.
   - **Logical Volume (LV):** یک حجم منطقی داخل یک Volume Group که بر روی آن مانند یک پارتیشن استفاده می‌شود.

2. **مثال اجرایی:**
   فرض کنید یک دیسک به نام `/dev/sdb` داریم و می‌خواهیم از طریق LVM از فضای آن استفاده کنیم. مراحل زیر نشان می‌دهند چگونه این کار را انجام داد:

   - **مرحله 1: ایجاد Physical Volume (PV):**
     ```bash
     pvcreate /dev/sdb
     ```
     این دستور یک Physical Volume با نام `/dev/sdb` ایجاد می‌کند.

   - **مرحله 2: ایجاد Volume Group (VG):**
     ```bash
     vgcreate myvg /dev/sdb
     ```
     این دستور یک Volume Group با نام `myvg` ایجاد می‌کند و به آن `/dev/sdb` را اضافه می‌کند.

   - **مرحله 3: ایجاد Logical Volume (LV):**
     ```bash
     lvcreate -L 10G -n mylv myvg
     ```
     این دستور یک Logical Volume با نام `mylv` و اندازه 10 گیگابایت در Volume Group `myvg` ایجاد می‌کند.

   - **مرحله 4: فرمت و Mount کردن Logical Volume:**
     ```bash
     mkfs.ext4 /dev/myvg/mylv
     mount /dev/myvg/mylv /mnt/mylv
     ```
     این دستورات Logical Volume را فرمت کرده و سپس در مسیر `/mnt/mylv` مانت می‌کنند.

حالا می‌توانید به راحتی از Logical Volume ایجاد شده به عنوان یک پارتیشن در سیستم خود استفاده کنید. این مثال تاکید می‌کند که LVM به شما این امکان را می‌دهد که به راحتی حجم‌ها را مدیریت و تغییر اندازه دهید بدون ایجاد اختلال در عملکرد سیستم.








در لینوکس، **LVM** (Logical Volume Manager) سیستمی برای مدیریت پویا و منعطفِ فضای ذخیره‌سازی است. با LVM می‌توانید دیسک‌ها (یا پارتیشن‌ها) را در یک یا چند **Physical Volume** (PV) گرد هم آورید، از آنها یک **Volume Group** (VG) بسازید و سپس داخل آن، **Logical Volume**‌ها (LV) تعریف و هر زمان که نیاز بود به‌راحتی اندازه‌شان را بزرگ یا کوچک کنید.

---

## ساختار و اجزاء LVM

1. **Physical Volume (PV)**  
   هر پارتیشن یا دیسک فیزیکی که با `pvcreate` برای LVM آماده می‌شود.
2. **Volume Group (VG)**  
   مجموعه‌ای از یک یا چند PV که با `vgcreate` ساخته می‌شود.
3. **Logical Volume (LV)**  
   بخش‌هایی از VG که با `lvcreate` تعریف می‌شوند و درست مثل پارتیشن در اختیار سیستم فایل قرار می‌گیرند.

```bash
# مثال ساختن یک PV روی /dev/sdb1
pvcreate /dev/sdb1

# ساختن VG به نام vg_data با یک PV
vgcreate vg_data /dev/sdb1

# ایجاد یک LV به نام lv_mysql با حجم 10G
lvcreate -n lv_mysql -L 10G vg_data

# فرمت کردن LV و مانت کردن آن
mkfs.ext4 /dev/vg_data/lv_mysql
mount /dev/vg_data/lv_mysql /mnt/mysql
```

---

## افزایش حجم Logical Volume

برای افزایش حجم، سه مرحله کلی دارید:

۱. **افزودن فضای فیزیکی (در صورت نیاز)**  
   - اگر فضای خالی در VG ندارید، ابتدا دیسک یا پارتیشن جدید را با `pvcreate` اضافه و سپس با `vgextend` وارد VG کنید:
     ```bash
     pvcreate /dev/sdc1
     vgextend vg_data /dev/sdc1
     ```

۲. **افزایش حجم LV**  
   - با `lvextend` حجم LV را افزایش دهید. می‌توانید با `-L +5G` اضافه کنید یا با `-l +100%FREE` تمام فضای خالی را اختصاص دهید:
     ```bash
     lvextend -L +5G /dev/vg_data/lv_mysql
     # یا
     lvextend -l +100%FREE /dev/vg_data/lv_mysql
     ```

۳. **گسترش سیستم فایل**  
   - بسته به نوع FS، دستور متفاوت است:
     - **ext4**:
       ```bash
       resize2fs /dev/vg_data/lv_mysql
       ```
     - **XFS** (بالای کرنل ۳٫۱۸):
       ```bash
       xfs_growfs /mnt/mysql
       ```

> ⚠️ **نکته:** اگر حجم LV را به‌صورت آنلاین (در حال کار) افزایش می‌دهید، سیستم فایل ext4 نیاز به unmount ندارد؛ XFS هم تنها با دستور `xfs_growfs` روی mount-point کار می‌کند.

---

## کاهش حجم Logical Volume

برای کوچک کردن حجم LV، دقت کنید که ابتدا **حجم سیستم فایل** باید کمتر از حجم نهایی LV باشد. کلیات مراحل:

۱. **چک و کوچک کردن سیستم فایل**  
   - با unmount یا در حالت تک‌کاربره (single-user mode) پرتاب کنید:
     ```bash
     umount /mnt/mysql
     e2fsck -f /dev/vg_data/lv_mysql     # برای ext4
     resize2fs /dev/vg_data/lv_mysql 8G  # کوچک کردن سیستم فایل به 8G
     ```
   - برای XFS امکان shrink (کوچک کردن) وجود ندارد؛ باید LV را به ext4 تبدیل کنید یا اطلاعات را در جایی دیگر موقتاً کپی کنید.

2. **کاهش حجم LV**  
   - با `lvreduce` حجم LV را کم کنید:
     ```bash
     lvreduce -L 8G /dev/vg_data/lv_mysql
     ```

3. **مانت مجدد و چک نهایی**  
   ```bash
   mount /dev/vg_data/lv_mysql /mnt/mysql
   df -h /mnt/mysql
   ```

> ⚠️ **هشدار مهم:** همیشه قبل از کاهش حجم، از داده‌ها **پشتیبان** (backup) بگیرید. کوچک کردن LV می‌تواند باعث از دست رفتن داده شود.

---

## فرمان‌های مفید برای بررسی وضعیت

- نمایش همه PV‌ها:
  ```bash
  pvs
  ```
- نمایش همه VG‌ها (و فضاهای استفاده/خالی):
  ```bash
  vgs
  ```
- نمایش همه LV‌ها (و حجم‌شان):
  ```bash
  lvs
  ```
- جزئیات دقیق یک LV:
  ```bash
  lvdisplay /dev/vg_data/lv_mysql
  ```

---

### 📌 جمع‌بندی گام‌به‌گام

| عملیات                | دستورات اصلی                                                      |
|------------------------|--------------------------------------------------------------------|
| آماده‌سازی دیسک       | `pvcreate` → `vgcreate`                                            |
| ایجاد LV               | `lvcreate -n <name> -L <size> <VG>`                                |
| افزایش حجم LV          | (1) `vgextend` [اختیاری] <br> (2) `lvextend -L +<size>` <br> (3) `resize2fs`/`xfs_growfs` |
| کاهش حجم LV            | (1) `umount` + `e2fsck` + `resize2fs` <br> (2) `lvreduce -L <size>` <br> (3) `mount` |

با این روش‌ها می‌توانید به‌راحتی و با کمترین قطعی، حجم فضای منطقی در لینوکس را افزایش یا کاهش دهید. اگر سؤال یا مشکلی در هر مرحله داشتید، خوشحال می‌شوم بیشتر راهنمایی کنم!
